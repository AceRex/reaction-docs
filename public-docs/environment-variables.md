---
id: environment-variables
title: Environment Variables
sidebar_label: Environment Variables
---

Reaction Commerce is a system made up of various services and web servers, each of which is distributed as a Docker image, or can be customized and then built into your own Docker image. Container-based microservice deployments typically get much of their configuration from environment variables, and Reaction is no exception. Some environment variables are required because they tell a container service how to connect to another service or a database. Others are optional with sensible defaults, but allow you to customize the system to meet your needs.

This article aims to be a full listing of the required and optional environment variables used by all components of the Reaction Commerce system. If you discover any missing variables, please submit a pull request to update this article.

> If you are a developer, check out [Developer Concepts: Environment Variables](./developer-environment-variables) for more information.

> For details about how these have changed since the previous release, refer to [Upgrading](./upgrading).


### API

- `GRAPHQL_INTROSPECTION_ENABLED`: Optional. Set to `true` to allow introspection of the GraphQL API when `NODE_ENV` is `production`.
- `GRAPHQL_PLAYGROUND_ENABLED`: Optional. Set to `true` to serve the GraphQL Playground UI from `/graphql` when `NODE_ENV` is `production`.
- `HYDRA_OAUTH2_INTROSPECT_URL`: Required for the API to authenticate requests that include an `Authorization` token generated by Hydra.
- `MAIL_URL`: Required if the `email-smtp` plugin is registered. An SMTP mail url, e.g. `smtp://user:pass@example.com:465`.
- `MONGO_URL`: Required. The MongoDB connection string URL, including the name of the database you want to use.
- `PORT`: Optional. Set to any port number to run the Express server on a port other than 3000.
- `REACTION_ADMIN_PUBLIC_ACCOUNT_REGISTRATION_URL`: Required. The registration URL to be used in new account invitation emails.
- `REACTION_GRAPHQL_SUBSCRIPTIONS_ENABLED`: Optional. Set this to false if you do not need GraphQL subscription support
- `REACTION_IDENTITY_PUBLIC_PASSWORD_RESET_URL`: Required. The URL of the password reset UI (e.g., `/account/reset-password/TOKEN`) on the Reaction Identity domain, with all-uppercase `TOKEN` as the placeholder for the reset token.
- `REACTION_IDENTITY_PUBLIC_VERIFY_EMAIL_URL`: Required. The URL of the email verification UI (e.g., `/#/verify-email/TOKEN`) on the Reaction Identity domain, with all-uppercase `TOKEN` as the placeholder for the verification token.
- `REACTION_LOG_LEVEL`: Optional. If you don't set this, the development default is "DEBUG" and the production default is "WARN".
- `REACTION_SHOULD_INIT_REPLICA_SET`: Optional. If this is `true`, on startup the API will auto-initialize a MongoDB replica set if one isn't found. This is `true` by default when `NODE_ENV` is `development`; otherwise, it's `false`.
- `REACTION_WORKERS_ENABLED`: Optional. Set to `false` to disable background job workers. Be careful because at least one instance must be working background jobs or features such as emailing and file uploads won't work.
- `ROOT_URL`: Required. The root URL with protocol, such as `https://shop.mydomain.me`.
- `STRIPE_API_KEY`: Required if you want Stripe payments to work. If you aren't using Stripe but you have the `payments-stripe` plugin registered, set this to any string.

### Hydra

> Other environment variables or configuration options may be available. Refer to the [Hydra documentation](https://www.ory.sh/docs/oryos.11/hydra/).

- `DSN`: Required. The Postres database connection string.
- `OAUTH2_EXPOSE_INTERNAL_ERRORS`: Optional. Useful for debugging. Refer to https://www.ory.sh/docs/next/hydra/debugging#first-aid
- `OIDC_SUBJECT_IDENTIFIERS_ENABLED`: Required. Be careful not to change this in production. Refer to https://www.ory.sh/docs/oryos.9/hydra/advanced#openid-connect
- `OIDC_SUBJECT_IDENTIFIERS_PAIRWISE_SALT`: Required. Be careful not to change this in production. Refer to https://www.ory.sh/docs/oryos.9/hydra/advanced#openid-connect
- `SECRETS_SYSTEM`: Required. A unique secret key.
- `URLS_CONSENT`: Required. Reaction Identity consent URL (the root URL plus `/consent`).
- `URLS_ERROR`: Required. Reaction Identity errors URL (the root URL plus `/account/oauth-error`).
- `URLS_LOGIN`: Required. Reaction Identity login URL (the root URL plus `/login`).
- `URLS_LOGOUT`: Required. Reaction Identity logout URL (the root URL plus `/logout`).
- `URLS_SELF_ISSUER`: Required. The public URL of Hydra.

### Example Storefront

- `CANONICAL_URL`: Required. The canonical root public URL for your storefront.
- `ENABLE_SPA_ROUTING`: Optional. By default, the example storefront uses in-browser routing as you click links to move around the site. In other words, the pages are not requested from the NextJS server but rather generated locally. If you need all links to do a full page refresh, then set this to "false".
- `EXTERNAL_GRAPHQL_URL`: Required. Ensure this is the public API URL.
- `INTERNAL_GRAPHQL_URL`: Required. Ensure this is the internal API URL.
- `NODE_ENV`: When running locally, you must be sure that `NODE_ENV` is NOT in your `.env` file. For deployed environments (including non-production), be sure to set `NODE_ENV` to `production` or NextJS will run in development mode, which makes pages take a long time to load.
- `OAUTH2_ADMIN_PORT`: Required. The internal Hydra admin port, which is `4445` unless you have changed it.
- `OAUTH2_ADMIN_URL`: Required. The internal Hydra admin URL with port, which is `http://hydra:4445` unless you have changed it.
- `OAUTH2_AUTH_URL`: Required. Hydra's public OAuth "auth" URL, where the path portion is `/oauth2/auth`.
- `OAUTH2_CLIENT_ID`: Required. On startup, the storefront service will create or update a Hydra service with this name.
- `OAUTH2_CLIENT_SECRET`: Required. On startup, the storefront service will create or update a Hydra service with this client secret.
- `OAUTH2_PUBLIC_LOGOUT_URL`: Required. Hydra's public OpenID Connect logout URL, where the path portion is `/oauth2/sessions/logout`.
- `OAUTH2_HOST`: Required. The internal Hydra hostname, which is `hydra` unless you have changed it.
- `OAUTH2_IDP_PUBLIC_CHANGE_PASSWORD_URL`: Required. The full public URL for the change password page on Reaction Identity. The path portion should be `/account/change-password?email=EMAIL&from=FROM`. Uppercase `EMAIL` and `FROM` placeholders are replaced with the current user's email address and the current page URL.
- `OAUTH2_IDP_HOST_URL`: Required. The full internal URL and port for the new Reaction Identity service. Usually something like `http://identity:4100`.
- `OAUTH2_TOKEN_URL`: Required. The full internal URL for Hydra's token endpoint. Usually something like `http://hydra:4444/oauth2/token`.
- `PORT`: Optional. Port on which to run the storefront server in the container. Defaults to `4000`.
- `SEGMENT_ANALYTICS_SKIP_MINIMIZE`: Optional. Default is `false`. In development, you may want to set this to `true` to skip minimization of the Segment Analytics code snippet.
- `SEGMENT_ANALYTICS_WRITE_KEY`: Optional. Set this if you want to track storefront analytics such as page views with Segment. You can find this key on your Segment dashboard.
- `SESSION_MAX_AGE_MS`: Optional. The maximum age in milliseconds for the storefront session cookie, which is used for authentication. Default is 24 hours. Note that Hydra also tracks an authentication session with its own cookie, so setting this lower than the Hydra cookie lifetime will likely result in users being silently logged back in if they are still "logged in" to Hydra. For this reason, it is less confusing if you set this to match the `HYDRA_SESSION_LIFESPAN` variable on Reaction Identity service, keeping in mind that `HYDRA_SESSION_LIFESPAN` is in seconds rather than milliseconds.
- `SESSION_SECRET`: Required. A unique key for cookie session verification. See https://www.npmjs.com/package/cookie-session#secret
- `STRIPE_PUBLIC_API_KEY`: Optional. Necessary if you are using Stripe payments. This is the public / client key from your Stripe dashboard. Do NOT use your secret key here, and be sure to use your "test" key in all non-production environments.
- `SITEMAP_MAX_AGE`: Optional. The "max-age" value for the "Cache-Control" header included when serving the `sitemap.xml` file. Default is `43200` (12 hours).

### Admin
- `METEOR_DISABLE_OPTIMISTIC_CACHING`: For local development only, set this to `1`.
- `METEOR_WATCH_POLLING_INTERVAL_MS`: For local development only, set this to the number of milliseconds to wait between polling for file changes, which makes Meteor perform better in a Docker container.
- `MONGO_OPLOG_URL`: Required. The oplog URL for the MongoDB deployment.
- `MONGO_URL`: Required. The MongoDB database URL.
- `PORT`: Required. The port to run the Node server on, in the container. Recommend `4080`.
- `API_URL`: Required. A Reaction API URL that is accessible from browsers and accepts GraphQL POST requests over HTTP.
- `HYDRA_ADMIN_URL`: Required. The internal Hydra admin URL with port, which is `http://hydra:4445` unless you have changed it.
- `HYDRA_TOKEN_URL`: Required. The full internal URL for Hydra's token endpoint. Usually something like `http://hydra:4444/oauth2/token`.
- `HYDRA_OAUTH2_ERROR_URL`: Optional. A public page to redirect to whenever there is an error communicating with Hydra.
- `HYDRA_SESSION_LIFESPAN`: Optional. The maximum age in seconds for the storefront session cookie, which is used for authentication. Default is `86400` (24 hours). It can be helpful to set this to match the `SESSION_MAX_AGE_MS` variable on the storefront, keeping in mind that `SESSION_MAX_AGE_MS` is in milliseconds rather than seconds.
- `MOCK_TLS_TERMINATION`: Default is `false`. If `true`, adds `"X-Forwarded-Proto": "https"` header to the Hydra OAuth PUT requests.
- `OAUTH2_CLIENT_DOMAINS`: Optional. Comma-separated list of allowed origins for the token refresh `Access-Control-Allow-Origin` header.
- `ROOT_URL`: The canonical root public URL for the Reaction Identity server.

### Identity
- `METEOR_DISABLE_OPTIMISTIC_CACHING`: For local development only, set this to `1`.
- `METEOR_WATCH_POLLING_INTERVAL_MS`: For local development only, set this to the number of milliseconds to wait between polling for file changes, which makes Meteor perform better in a Docker container.
- `MONGO_OPLOG_URL`: Required. The oplog URL for the MongoDB deployment.
- `MONGO_URL`: Required. The MongoDB database URL.
- `PORT`: Required. The port to run the Node server on, in the container. Recommend `4080`.
- `PUBLIC_GRAPHQL_API_URL_HTTP`: Required. A Reaction API URL that is accessible from browsers and accepts GraphQL POST requests over HTTP.
- `PUBLIC_GRAPHQL_API_URL_WS`: Optional. A Reaction API URL that is accessible from browsers and accepts GraphQL WebSocket connections. Usually the same as `PUBLIC_GRAPHQL_API_URL_HTTP` but replace `http` with `ws`. If this is set, GraphQL subscriptions will be enabled in browser code.
- `PUBLIC_FILES_BASE_URL`: Required. A full public URL that has /assets/files and /assets/uploads endpoints for uploading and downloading files. Typically this is the API service root URL.
- `PUBLIC_I18N_BASE_URL`: Required. A full public URL that has /locales/namespaces.json and /locales/resources.json endpoints for loading translations. Typically this is the API service root URL.
- `PUBLIC_STOREFRONT_HOME_URL`: Required. The URL for your storefront home page. This is only used as fallback if a URL isn't set for the shop.
- `ROOT_URL`: The canonical root public URL for the Reaction Admin server.
